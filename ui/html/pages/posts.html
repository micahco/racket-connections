{{define "title"}}Posts{{end}}

{{define "main"}}   
    <article>
        <h3>Filters</h3>
        <form action="" method="GET">
            <fieldset>
                <legend>
                    Sports
                </legend>

                {{range $sport := .Data.Sports}}
                    <div>
                        <label for="{{$sport.Name}}">{{$sport.Name}}</label>
                        <input type="checkbox" name="sport" value="{{$sport.Name}}" id="{{$sport.Name}}"
                            {{range $.Data.Query.Sport}}
                                {{if eq . $sport.Name}}
                                    checked
                                {{end}}
                            {{end}}
                        />
                    </div>
                {{end}}
            </fieldset>

            <fieldset>
                <legend>
                    Availability
                </legend>

                <table>
                    <thead>
                        <tr>
                            <th scope="col">
                                Day
                            </th>
                            {{range .Data.Times}}
                                <th scope="col">
                                    {{.Name}}
                                </th>
                            {{end}}
                        </tr>
                    </thead>
                    <tbody>
                        {{range $day := .Data.Days}}
                            <tr>
                                <th class="day-header" scope="row">
                                    <button type="button">
                                        {{$day.Abbrev}}
                                    </button>
                                </th>
                                {{range $time := $.Data.Times}}
                                    <td>
                                        <input type="checkbox" name="{{$day.Abbrev}}-{{$time.Abbrev}}"
                                            {{range $.Data.Query.Timeslot}}
                                                {{if eq . (printf "%s-%s" $day.Abbrev $time.Abbrev)}}
                                                    checked
                                                {{end}}
                                            {{end}}
                                        />
                                    </td>
                                {{end}}
                            </tr>
                        {{end}}
                    </tbody>
                </table>
            </fieldset>

            <a href="?">Clear</a>

            <button type="reset">Reset</button>

            <button type="submit">Apply</button>
        </form>
    </article>

    <section>
        <h1>
            Posts
        </h1>

        {{range $sport := .Data.Sports}}
        {{if $posts := index $.Data.PostsMap $sport.ID}}
            <section>
                <h2>
                    {{$sport.Name}}
                </h2>

                <ul>
                    {{range $posts}}
                        <li>
                            <a href="/posts/{{.ID}}/{{queryEscape .UserName}}">
                                {{.UserName}}
                            </a>
                            
                            <span>
                                {{.SkillLevel}}
                            </span>
                            
                            <span>
                                {{since .CreatedAt}}
                            </span>
                        </li>
                    {{end}}
                </ul>
            </section>
        {{end}}
    {{end}}
    </section>
{{end}}

{{define "scripts"}}
<script src="/static/scripts/posts.js"></script>
{{end}}
